<div class="character-sheet-wrapper">
  @let character = character$ | async;

  <div class="header">
    <div class="header-content">
      <a routerLink="/">
        <app-header></app-header>
      </a>
    </div>
  </div>
  <div class="navigation">
    <div class="navigation-section">
      <ul class="navigation-items">
        @for (character of characters$ | async; track character.id) {
          <li class="navigation-item" >
            <a routerLinkActive="active" [routerLink]="['/', character.id]">{{ character.playerName }}</a>
          </li>
        }
      </ul>

      @if (!isLoading && isChanged && character && !isSaving) {
        <div class="controls">
          <button (click)="onSave(character.id)" class="control control-save">
            <svg-icon class="control-icon" src="/icons/save.svg"></svg-icon>
          </button>
          <button (click)="onRevert()" class="control control-revert">
            <svg-icon class="control-icon" src="/icons/revert.svg"></svg-icon>
          </button>
        </div>
      } @else if (isSaving) {
        <div class="saving-loader">
          Saving...
        </div>
      }
    </div>
  </div>
  <div class="info">

    @if(!isLoading && character) {
      <div class="info-section">
        <div class="character-image">
          <img src="/images/{{character.imageUrl}}">
        </div>
        <div class="character-name">
          {{ character.name }}
        </div>
        <div class="character-age">
          <span>{{ character.age }}</span> y.o.
        </div>

        <div class="info-table">
          <table>
            <tr>
              <td class="info-table-label">Virtue</td>
              <td class="info-table-value">{{ character.virtue }}</td>
            </tr>
            <tr>
              <td class="info-table-label">Vice</td>
              <td class="info-table-value">{{ character.vice }}</td>
            </tr>
            <tr>
              <td class="info-table-label">Concept</td>
              <td class="info-table-value">{{ character.concept }}</td>
            </tr>
          </table>
        </div>
      </div>
    }
  </div>
  <div class="sheet">
    @if (!isLoading && character) {
      <div class="sheet-wrapper">
        <div class="section-row">
          <div class="section-column stats">
            <app-stats [character]="character!" (statsChange)="onStatsChange($event)"></app-stats>
          </div>
          <div class="section-column merits">
            <app-merits [character]="character" (meritsChange)="onMeritsChange($event)"></app-merits>
          </div>
          <div class="section-column">
            <app-stats-additional [character]="character" (statsAdditionalChange)="onStatsAdditionalChange($event)"></app-stats-additional>
          </div>
        </div>
      </div>
    } @else {
      <div class="loader">
        Loading...
      </div>
    }
  </div>
</div>
